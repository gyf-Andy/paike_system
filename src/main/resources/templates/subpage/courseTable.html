<!DOCTYPE html>
<!--解决idea thymeleaf 表达式模板报红波浪线-->
<!--suppress ALL -->
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>教师管理</title>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <link rel="stylesheet" href="/bootstrap-4.6.0-dist/css/bootstrap.min.css">
    <script src="/bootstrap-4.6.0-dist/js/bootstrap.min.js"></script>
</head>

<style>

    .tdHover:hover {
        background: rgba(2,124,255,0.13);
    }
</style>

<body>

<div>
    <div class="container" >
        <div class="row mt-5" >
            <div class="col-md-3 " style="height: 100px">
                <h2>管理员：<span class="text-primary"><span shiro:principal/></span></h2>
                <h5>请选择你的操作</h5>
            </div>
            <div class="col-md-6 text-center">
                <div class="mt-4 font-weight-bold" style="font-size: 30px">
                    <span th:text="${session.faculty}"></span>
                    <span>课程表</span>
                </div>
            </div>
            <div class="col-md-3 text-right" >
                <div class="btn-group mt-5">
                    <a href="/test/toHomePage.action">
                        <button type="button" class="btn btn-primary ml-2">返回</button>
                    </a>
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-12">
                <table class="table table-bordered text-center" style="height: 500px">
                    <thead class="thead-dark">
                    <tr>
                        <th scope="col">节  数</th>
                        <th scope="col">星期一</th>
                        <th scope="col">星期二</th>
                        <th scope="col">星期三</th>
                        <th scope="col">星期四</th>
                        <th scope="col">星期五</th>
                        <th scope="col">星期六</th>
                        <th scope="col">星期日</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="height: 90px">
                        <th scope="row">1-2节</th>
                        <td id="table_1_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_2_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_3_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_4_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_5_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_6_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_7_1" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                    </tr>
                    <tr style="height: 90px">
                        <th scope="row">3-4节</th>
                        <td id="table_1_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_2_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_3_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_4_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_5_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_6_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_7_2" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                    </tr>
                    <tr style="height: 90px">
                        <th scope="row">5-6节</th>
                        <td id="table_1_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_2_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_3_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_4_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_5_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_6_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_7_3" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                    </tr>
                    <tr style="height: 90px">
                        <th scope="row">7-8节</th>
                        <td id="table_1_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_2_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_3_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_4_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_5_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_6_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_7_4" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                    </tr>
                    <tr style="height: 90px">
                        <th scope="row">9-10节</th>
                        <td id="table_1_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_2_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_3_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_4_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_5_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_6_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                        <td id="table_7_5" class="tdHover" data-toggle="modal" data-target="#exampleModal" onclick="getId(this.id)"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 添加模态框 -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">添加课程信息</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="form">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="inputEmail4">教室编号</label>
                            <select class="form-control" name="classroomName">
                                <span th:each="classroomName:${classroomNameList}">
                                    <option th:value="${classroomName}" th:text="${classroomName}"></option>
                                </span>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="inputPassword4">教师名</label>
                            <select class="form-control" name="teacherName">
                                <span th:each="teacherName:${teacherNameList}">
                                    <option th:value="${teacherName}" th:text="${teacherName}"></option>
                                </span>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputAddress">课程名</label>
                        <!--                        <input type="text" class="form-control" name="projector" id="inputAddress" placeholder="是否有投影仪">-->
                        <select class="form-control" name="courseName">
                            <span th:each="courseName:${courseNameList}">
                                <option th:value="${courseName}" th:text="${courseName}"></option>
                            </span>
                        </select>
                    </div>
                    <input type="hidden" name="day" id="day">
                    <input type="hidden" name="whichSection" id="whichSection">
                    <input type="hidden" name="faculty" th:value="${session.faculty}">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="tianjia">确认</button>
            </div>
        </div>
    </div>
</div>

<script>

    window.onload=function(){
        $(function(){
            $.ajax({
                url:'/test/getCourseTable.action',
                type:'post',
                success:function (msg) {
                    //清空课程表
                    for(var i=1;i<=5;i++){
                        for(var j=1;j<=7;j++){
                            $("#table_"+j+"_"+i).html("");
                        }
                    }
                    $("#table_"+msg.data[0].day+"_"+msg.data[0].whichSection)

                    //遍历课程表
                    for (var i=0;i<msg.data.length;i++) {
                        $("#table_"+msg.data[i].day+"_"+msg.data[i].whichSection).html(msg.data[i].classroomName+"<br>"+msg.data[i].courseName+"<br>"+msg.data[i].teacherName);
                    }

                }

            })
        })
    }

    function getId(id) {
        var day=id.substring(6,7);
        var whichSection=id.substring(8,9);
        $('#day').val(day);
        $('#whichSection').val(whichSection);
    }

    $(function(){
        $("#tianjia").click(function(){
            $.ajax({
                url: '/test/addCourseToTable.action',
                type: 'post',
                data: $('#form').serialize(),
                success: function(msg){
                    // alert(msg.code);
                    //code==200证明登陆成功
                    sleep(500).then(()=>{
                        alert(msg.msg)
                        location.reload(true);
                    })
                    // alert(msg.msg)
                    // location.reload(true);
                },
                error: function(){
                    alert("访问出错！");
                }
            });
        });
    })

    //进程阻塞
    function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

</script>

</body>
</html>
